(function(f){var k=function(b){return"undefined"===typeof f[b]?("undefined"!==typeof console&&console.log('Warning: "hdr2d" canvas context not supported ('+b+" needed)"),!1):!0};if(k("HTMLCanvasElement")&&k("ArrayBuffer")&&k("Float32Array")){f.HDR2D_BLEND_SRC=0;f.HDR2D_BLEND_DST=1;f.HDR2D_BLEND_CLEAR=2;f.HDR2D_BLEND_XOR=3;f.HDR2D_BLEND_OVER=4;f.HDR2D_BLEND_IN=5;f.HDR2D_BLEND_OUT=6;f.HDR2D_BLEND_ATOP=7;f.HDR2D_BLEND_DST_OVER=8;f.HDR2D_BLEND_DST_IN=9;f.HDR2D_BLEND_DST_OUT=10;f.HDR2D_BLEND_DST_ATOP=
11;f.HDR2D_BLEND_ADD=12;f.HDR2D_BLEND_SUBTRACT=13;k=document.createElement("canvas");k.width=1;k.height=1;var o=k.getContext("2d"),l=o.getImageData(0,0,1,1),m=function(b,a){this.width=b;this.height=a;this.data=new Float32Array(new ArrayBuffer(16*b*a))},i=function(b){this._context=b.getContext.apply(b,["2d"]);this._imageData=this._context.getImageData(0,0,b.width,b.height);this.imageData=new m(b.width,b.height);this.canvas=b};i.prototype.globalAlpha=1;i.prototype.globalBlendMode=HDR2D_BLEND_OVER;i.prototype.range=
{r:{low:0,high:255},g:{low:0,high:255},b:{low:0,high:255},a:{low:0,high:255}};i.prototype.getBlendFunction=function(){var b={};b[HDR2D_BLEND_SRC]={component:function(a,c,e){return a*e},alpha:function(a){return a}};b[HDR2D_BLEND_DST]={component:function(a,c,e,b){return c*b},alpha:function(a,c){return c}};b[HDR2D_BLEND_CLEAR]={component:function(){return 0},alpha:function(){return 0}};b[HDR2D_BLEND_XOR]={component:function(a,c,e,b){return a*e*(1-b)+c*b*(1-e)},alpha:function(a,c){return a+c-2*a*c}};
b[HDR2D_BLEND_OVER]={component:function(a,c,b,d){return a*b+c*d*(1-b)},alpha:function(a,c){return a+c-a*c}};b[HDR2D_BLEND_IN]={component:function(a,c,b,d){return a*b*d},alpha:function(a,c){return a*c}};b[HDR2D_BLEND_OUT]={component:function(a,c,b,d){return a*b*(1-d)},alpha:function(a,c){return a*(1-c)}};b[HDR2D_BLEND_ATOP]={component:function(a,c,b,d){return a*b*d+c*d*(1-b)},alpha:function(a,c){return c}};b[HDR2D_BLEND_DST_OVER]={component:function(a,c,b,d){return c*d+a*b*(1-d)},alpha:function(a,
c){return a+c-a*c}};b[HDR2D_BLEND_DST_IN]={component:function(a,c,b,d){return c*d*b},alpha:function(a,c){return a*c}};b[HDR2D_BLEND_DST_OUT]={component:function(a,c,b,d){return c*d*(1-b)},alpha:function(a,c){return c*(1-a)}};b[HDR2D_BLEND_DST_ATOP]={component:function(a,c,b,d){return c*d*b+a*b*(1-d)},alpha:function(a){return a}};b[HDR2D_BLEND_ADD]={component:function(a,b,e,d){return b*d+a+e},alpha:b[HDR2D_BLEND_OVER].alpha};b[HDR2D_BLEND_SUBTRACT]={component:function(a,b,e,d){return b*d-a+e},alpha:b[HDR2D_BLEND_OVER].alpha};
return function(a){return b[a]}}();i.prototype.setPixel=function(b,a,c){var e=4*(Math.round(b)+Math.round(a)*this.canvas.width),d=this.getBlendFunction(this.globalBlendMode);"undefined"===typeof c.a&&(c.a=255);var h=imageData2DHDR.data[e+3]/255,g=c.a*o.globalAlpha/255;this.imageData.data[e]=d.component(c.r,this.imageData.data[e],g,h);this.imageData.data[e+1]=d.component(c.g,this.imageData.data[e+1],g,h);this.imageData.data[e+2]=d.component(c.b,this.imageData.data[e+2],g,h);this.imageData.data[e+3]=
255*d.alpha(g,h);l.data[0]=255*((this.imageData.data[e]-this.range.r.low)/(this.range.r.high-this.range.r.low));l.data[1]=255*((this.imageData.data[e+1]-this.range.g.low)/(this.range.g.high-this.range.g.low));l.data[2]=255*((this.imageData.data[e+2]-this.range.b.low)/(this.range.b.high-this.range.b.low));l.data[3]=255*((this.imageData.data[e+3]-this.range.a.low)/(this.range.a.high-this.range.a.low));context2D.putImageData(l,b,a)};i.prototype.getPixel=function(b,a){var c=4*(Math.round(b)+Math.round(a)*
this.imageData.width);return{r:this.imageData.data[c],g:this.imageData.data[c+1],b:this.imageData.data[c+2],a:this.imageData.data[c+3]}};i.prototype.getImageData=function(b,a,c,e){if(0===b&&0===a&&c===this.imageData.width&&e===this.imageData.height)return this.imageData;var d=Math.min(c,this.imageData.width-b),h=Math.min(e,this.imageData.height-a),e=b+d,c=a+h,d=new m(d,h),g,f,h=0;for(g=a;g<c;g++)for(a=b;a<e;a++)f=4*(g*this.imageData.width+a),d.data[h++]=this.imageData.data[f],d.data[h++]=this.imageData.data[f+
1],d.data[h++]=this.imageData.data[f+2],d.data[h++]=this.imageData.data[f+3];return d};i.prototype.drawImage=function(b,a,c,e,d){var h=arguments,g=b.width,f=b.height;5<arguments.length&&(g=h[3],f=h[4],a=h[5],c=h[6],e=h[7],d=h[8]);a=a||0;c=c||0;e=e||g;d=d||f;g=document.createElement("canvas");g.width=this.imageData.width;g.height=this.imageData.height;g=g.getContext("2d");g.globalAlpha=1;g.drawImage.apply(g,h);var j,i,k,l,n,h=this.getBlendFunction(this.globalBlendMode),g=g.getImageData(0,0,this.imageData.width,
this.imageData.height).data,f=Math.floor(a);j=Math.floor(c);var m=Math.min(this.imageData.width,Math.ceil(a+e)),p=Math.min(this.imageData.height,Math.ceil(c+d));for(k=j;k<p;k++)for(i=f;i<m;i++)j=4*(k*this.imageData.width+i),n=this.imageData.data[j+3]/255,l=g[j+3]*o.globalAlpha/255,this.imageData.data[j]=h.component(g[j],this.imageData.data[j],l,n),this.imageData.data[j+1]=h.component(g[j+1],this.imageData.data[j+1],l,n),this.imageData.data[j+2]=h.component(g[j+2],this.imageData.data[j+2],l,n),this.imageData.data[j+
3]=255*h.alpha(l,n);this.render()};i.prototype.render=function(){var b=[],a;for(a in this.range)this.range.hasOwnProperty(a)&&b.push(this.range[a]);for(var c=0,e=this.imageData.data.length;c<e;c++)a=b[c%4],this._imageData.data[c]=255*((this.imageData.data[c]-a.low)/(a.high-a.low));this._context.putImageData(this._imageData,0,0)};f.ImageDataHDR=m;f.CanvasRenderingContextHDR2D=i;HTMLCanvasElement.prototype.getContext=function(){var b=HTMLCanvasElement.prototype.getContext;return function(){return"hdr2d"===
arguments[0]?new i(this):b.apply(this,arguments)}}()}})(window);
